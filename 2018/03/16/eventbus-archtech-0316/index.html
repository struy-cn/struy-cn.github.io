<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="åˆ†äº«ç¼–ç ã€æ¶æ„ç»éªŒã€æ•ˆç‡å·¥å…·ã€äººå·¥æ™ºèƒ½(AIGC) ã€é˜…è¯»æ„Ÿæ‚Ÿä»¥åŠä½ æ„Ÿå…´è¶£çš„çŸ¥è¯†è’åŸ!"><meta name="keywords" content="AIGC,æ¶æ„,äº‘åŸç”Ÿ,æ•ˆç‡å·¥å…·,ç¼–ç¨‹,ç¼–ç¨‹å…¥é—¨,ä»£ç ,å­¦ä¹ ,å…¨æ ˆ,Spring,Java,Scala,è€æ¨çš„çŸ¥è¯†è’åŸ,StruggleYang,struy"><title>äº‹ä»¶æ€»çº¿EventBuså®ç°æ¶æ„åŸç†åˆ†æ | è€æ¨çš„çŸ¥è¯†è’åŸ</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script src="https://www.googletagmanager.com/gtag/js?id=G-7HLMFGQR9B" async></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-7HLMFGQR9B');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement('script');
  hm.src = 'https://hm.baidu.com/hm.js?' + 'd2ed00d27f11374630ac0efc2332b027';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><div class="darkmode-toggle">ğŸŒ“</div><script>var prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)');
var toggle = document.querySelector('.darkmode-toggle');
var html = document.querySelector('html');

html.dataset.dark = localStorage.dark || prefersDarkMode.matches;

toggle.addEventListener('click', () => {
localStorage.dark = !(html.dataset.dark == 'true');
html.dataset.dark = localStorage.dark;
});</script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">äº‹ä»¶æ€»çº¿EventBuså®ç°æ¶æ„åŸç†åˆ†æ</h1><a id="logo" href="/.">è€æ¨çš„çŸ¥è¯†è’åŸ</a><p class="description">æ•ˆç‡å·¥å…·ã€ç¼–ç¨‹æŠ€æœ¯ã€é˜…è¯»æ„Ÿæ‚Ÿï¼›ä½ çœ‹åˆ°çš„ä¸–ç•Œå°±æ˜¯ä½ è‡ªå·±çš„æ ·å­ï¼</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/tools/"><i class="fa fa-coffee"> å·¥å…·ç®±</i></a><a href="/about/"><i class="fa fa-user"> å…³äº</i></a><a href="/atom.xml"><i class="fa fa-rss"> è®¢é˜…</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">äº‹ä»¶æ€»çº¿EventBuså®ç°æ¶æ„åŸç†åˆ†æ</h1><div class="post-meta">2018-03-16<!-- ç§»åŠ¨åˆ°footer.pug--><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> é˜…è¯»</span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">æ–‡ç« ç›®å½•</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#DDD%E9%A2%86%E5%9F%9F%E4%BA%8B%E4%BB%B6%E6%9E%B6%E6%9E%84%E7%AE%80%E6%9E%90"><span class="toc-number">1.</span> <span class="toc-text">DDDé¢†åŸŸäº‹ä»¶æ¶æ„ç®€æ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8D%E7%AE%A1%E6%98%AF%E9%A2%86%E5%9F%9F%E5%86%85%E4%BA%8B%E4%BB%B6%E8%BF%98%E6%98%AF%E8%B7%A8%E9%A2%86%E5%9F%9F%E4%BA%8B%E4%BB%B6%EF%BC%8C%E5%9C%A8EventBus%E8%A7%A6%E5%8F%91%E4%BA%8B%E4%BB%B6%E4%B9%8B%E5%90%8E%EF%BC%8C%E9%83%BD%E4%BC%9A%E9%80%89%E6%8B%A9%E5%B0%86%E6%B6%88%E6%81%AF%E6%8C%81%E4%B9%85%E5%8C%96%E5%88%B0%E4%B8%9A%E5%8A%A1%E6%95%B0%E6%8D%AE%E5%BA%93%E3%80%82"><span class="toc-number">1.1.</span> <span class="toc-text">ä¸ç®¡æ˜¯é¢†åŸŸå†…äº‹ä»¶è¿˜æ˜¯è·¨é¢†åŸŸäº‹ä»¶ï¼Œåœ¨EventBusè§¦å‘äº‹ä»¶ä¹‹åï¼Œéƒ½ä¼šé€‰æ‹©å°†æ¶ˆæ¯æŒä¹…åŒ–åˆ°ä¸šåŠ¡æ•°æ®åº“ã€‚123456def fireEvent(event: Any): Unit &#x3D; {  &#x2F;&#x2F; æœ¬åœ°äº‹ä»¶åˆ†å‘å¤„ç†  dispatchEvent(event) &#x2F;&#x2F;æŒä¹…åŒ–äº‹ä»¶  persistenceEvent(event)}</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B7%A8%E9%A2%86%E5%9F%9F%E4%BA%8B%E4%BB%B6%E6%B6%88%E6%81%AF%E4%BF%9D%E9%9A%9C"><span class="toc-number">2.</span> <span class="toc-text">è·¨é¢†åŸŸäº‹ä»¶æ¶ˆæ¯ä¿éšœ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#kafka%E5%AF%B9%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81%E7%9A%84%E4%BF%9D%E9%9A%9C"><span class="toc-number">2.1.</span> <span class="toc-text">kafkaå¯¹æ¶ˆæ¯å‘é€çš„ä¿éšœ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Kafka%E7%9A%84%E4%B8%89%E7%A7%8D%E8%AF%AD%E4%B9%89"><span class="toc-number">2.1.1.</span> <span class="toc-text">Kafkaçš„ä¸‰ç§è¯­ä¹‰</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E8%80%85%E7%AB%AF%EF%BC%88Producer%EF%BC%89%E6%B6%88%E6%81%AF%E4%BF%9D%E9%9A%9C"><span class="toc-number">2.2.</span> <span class="toc-text">ç”Ÿäº§è€…ç«¯ï¼ˆProducerï¼‰æ¶ˆæ¯ä¿éšœ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B6%88%E8%B4%B9%E8%80%85%E7%AB%AF%EF%BC%88Consumer%EF%BC%89%E6%B6%88%E6%81%AF%E4%BF%9D%E9%9A%9C"><span class="toc-number">2.3.</span> <span class="toc-text">æ¶ˆè´¹è€…ç«¯ï¼ˆConsumerï¼‰æ¶ˆæ¯ä¿éšœ</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#EventBus%EF%BC%88%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BF%EF%BC%89%E6%94%B6%E5%8F%91%E6%B6%88%E6%81%AF%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.</span> <span class="toc-text">EventBusï¼ˆäº‹ä»¶æ€»çº¿ï¼‰æ”¶å‘æ¶ˆæ¯å…·ä½“å®ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#EventBus%E7%94%9F%E4%BA%A7%E7%AB%AF%EF%BC%88Producer%EF%BC%89"><span class="toc-number">3.1.</span> <span class="toc-text">EventBusç”Ÿäº§ç«¯ï¼ˆProducerï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E7%94%9F%E4%BA%A7%E8%80%85%E7%AB%AF%E8%87%B3%E5%B0%91%E4%B8%80%E6%AC%A1"><span class="toc-number">3.1.1.</span> <span class="toc-text">å®ç°ç”Ÿäº§è€…ç«¯è‡³å°‘ä¸€æ¬¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E8%80%85%E9%85%8D%E7%BD%AE"><span class="toc-number">3.1.1.1.</span> <span class="toc-text">ç”Ÿäº§è€…é…ç½®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%BA%8B%E5%8A%A1%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-number">3.1.1.2.</span> <span class="toc-text">åˆ›å»ºäº‹åŠ¡ç”Ÿäº§è€…</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81"><span class="toc-number">3.1.1.3.</span> <span class="toc-text">æ‰¹é‡æ¶ˆæ¯å‘é€</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E8%BD%AE%E8%AF%A2"><span class="toc-number">3.1.2.</span> <span class="toc-text">æ¶ˆæ¯è½®è¯¢</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E7%9B%AE%E7%9A%84"><span class="toc-number">3.1.2.1.</span> <span class="toc-text">è®¾è®¡ç›®çš„</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E7%AB%AF%E6%80%BB%E7%BB%93"><span class="toc-number">3.1.3.</span> <span class="toc-text">ç”Ÿäº§ç«¯æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Eventbus%E6%B6%88%E6%81%AF%E7%AB%AF%EF%BC%88Consumer%EF%BC%89"><span class="toc-number">3.2.</span> <span class="toc-text">Eventbusæ¶ˆæ¯ç«¯ï¼ˆConsumerï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E7%9A%84%E7%BC%96%E8%A7%A3%E7%A0%81"><span class="toc-number">3.2.1.</span> <span class="toc-text">æ¶ˆæ¯çš„ç¼–è§£ç </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-number">3.2.2.</span> <span class="toc-text">å®ç°åŸç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B6%88%E8%B4%B9%E7%AB%AF%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">3.2.3.</span> <span class="toc-text">æ¶ˆè´¹ç«¯æ³¨æ„äº‹é¡¹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">4.</span> <span class="toc-text">æ€»ç»“</span></a></li></ol></div></div><div class="post-content"><blockquote>
<p>äº‹ä»¶æ€»çº¿(EventBus)è®¾è®¡åˆè¡·æ˜¯è§£è€¦ç³»ç»Ÿæ¨¡å—ï¼Œå°†ç³»ç»Ÿä¸­çš„å„ç±»ä¸šåŠ¡æ“ä½œæŠ½è±¡ä¸ºäº‹ä»¶æ¨¡å‹ã€‚æˆ‘ä»¬æŠŠäº§ç”Ÿäº‹ä»¶çš„éƒ¨åˆ†ç§°ä¹‹ä¸ºäº‹ä»¶çš„å‘é€è€…(Publisher)ï¼Œæ¶ˆè´¹äº‹ä»¶çš„éƒ¨åˆ†ç§°ä¹‹ä¸ºè®¢é˜…è€…(Subcriber)ã€‚</p>
</blockquote>
<span id="more"></span>

<p><a target="_blank" rel="noopener" href="https://github.com/dapeng-soa">@å¤§é¹å¼€æº</a>:åˆ«çœ‹æˆ‘æœ‰ç‚¹èŒï¼Œæˆ‘å¯ä»¥ç§’å˜å¤§é¹ã€‚<br><img src="http://upload-images.jianshu.io/upload_images/6393906-b7ba572342b3e4ba..jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¤§é¹é¸Ÿ"></p>
<h1 id="DDDé¢†åŸŸäº‹ä»¶æ¶æ„ç®€æ"><a href="#DDDé¢†åŸŸäº‹ä»¶æ¶æ„ç®€æ" class="headerlink" title="DDDé¢†åŸŸäº‹ä»¶æ¶æ„ç®€æ"></a>DDDé¢†åŸŸäº‹ä»¶æ¶æ„ç®€æ</h1><p>é¢†åŸŸäº‹ä»¶æ˜¯é¢†åŸŸé©±åŠ¨è®¾è®¡(Domain Driven Designï¼Œç®€ç§°DDD)ä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼Œé¢†åŸŸæ¨¡å‹çš„å˜åŒ–ä¼šäº§ç”Ÿé¢†åŸŸäº‹ä»¶ï¼Œäº‹ä»¶çš„äº§ç”Ÿå¾€å¾€ä¼´éšç€ç›¸åº”çš„åŠ¨ä½œã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·åœ¨å®Œæˆæ³¨å†Œåï¼Œç³»ç»Ÿä¼šå‘å‡ºä¸€å°å¸¦æœ‰ç¡®è®¤ä¿¡æ¯çš„é‚®ä»¶åˆ°ç”¨æˆ·çš„é‚®ç®±ã€‚æœ‰äº†é¢†åŸŸäº‹ä»¶ï¼Œæ¯ä¸ªé¢†åŸŸæœ¬èº«å°±åªéœ€è¦å…³ç³»å…¶è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¹¶åœ¨å¤„ç†å®Œè‡ªèº«é€»è¾‘çš„åŒæ—¶æŠ›å‡ºç›¸åº”çš„é¢†åŸŸäº‹ä»¶ã€‚å¯¹è¿™äº›é¢†åŸŸäº‹ä»¶æ„Ÿå…´è¶£çš„ä¸šåŠ¡æ–¹å¯ä»¥è®¢é˜…è¯¥äº‹ä»¶ï¼Œç„¶åè¿›è¡Œåç»­çš„å¤„ç†ã€‚</p>
<p>ç»“åˆé¢†åŸŸäº‹ä»¶å’ŒEventBusï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹åŸºäºTodayä¸­å°æ¶æ„çš„EventBusæ¶æ„æ¨¡å‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/6393906-a0cdb1c3e8040895.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="eventbusæ¨¡å‹.png"></p>
<p>é¢†åŸŸäº‹ä»¶äº§ç”Ÿåä¼šæœ‰ç›‘å¬è€…è¿›è¡Œäº‹ä»¶ç›‘å¬ã€‚åœ¨å¦‚æ­¤ä¼—å¤šçš„äº‹ä»¶ä¸­ï¼Œéœ€è¦ä¸€ä¸ªæ¶ˆæ¯æ€»çº¿å¯¹æ¶ˆæ¯è¿›è¡Œç»Ÿä¸€çš„ç®¡ç†ã€‚æ¶ˆæ¯æ€»çº¿çš„ä½œç”¨æœ‰ï¼š</p>
<p> 1.ä¸€ä¸ªå¤§çš„é¢†åŸŸå†…çš„å„å°æ¨¡å—ä¹‹é—´çš„äº‹ä»¶çš„è§¦å‘å’Œè®¢é˜…ï¼›</p>
<p> 2.è·¨é¢†åŸŸï¼ˆè·¨JVMè¿›ç¨‹ï¼‰ä¹‹é—´çš„äº‹ä»¶è®¢é˜…ã€‚</p>
<p>é¦–å…ˆé¢†åŸŸå†…æŸä¸ªæ–¹æ³•è§¦å‘äº‹ä»¶ï¼Œä¾‹å¦‚<code>registerUser()</code>æ–¹æ³•æ‰§è¡ŒæˆåŠŸåï¼Œä¼šå‘å¸ƒä¸€ä¸ªç”¨æˆ·åˆ›å»ºçš„äº‹ä»¶ã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦è°ƒç”¨<code>EventBus.fireEvent()</code>æ–¹æ³•ï¼Œå°±ä¼šå°†äº‹ä»¶å‘å¸ƒå‡ºå»ï¼Œåœ¨EventBuså†…éƒ¨ï¼Œå¦‚æœæœ¬é¢†åŸŸå†…æœ‰è®¢é˜…è€…è®¢é˜…æ­¤äº‹ä»¶ï¼ŒEventbuså°±ä¼šåŒ¹é…æ¶ˆæ¯çš„ç±»å‹ï¼Œç„¶åè¿›è¡Œç›¸åº”äº‹ä»¶çš„é€»è¾‘å¤„ç†ï¼Œè¿™æ ·å°±åšåˆ°äº†é¢†åŸŸå†…çš„äº‹ä»¶ç›‘å¬å’Œå¤„ç†ã€‚</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œäº‹ä»¶çš„å‘å¸ƒå’Œè®¢é˜…æ˜¯å¼ºä¸€è‡´æ€§çš„ï¼Œä¸¤è€…åœ¨åŒä¸€ä¸ªå¤„ç†è¿‡ç¨‹ä¸­ï¼Œå½“å‡ºç°é”™è¯¯ï¼Œè§¦å‘äº‹ä»¶æ–¹å’Œè®¢é˜…æ–¹çš„æ•°æ®ä¼šä¸€èµ·å›æ»šã€‚</p>
<h2 id="ä¸ç®¡æ˜¯é¢†åŸŸå†…äº‹ä»¶è¿˜æ˜¯è·¨é¢†åŸŸäº‹ä»¶ï¼Œåœ¨EventBusè§¦å‘äº‹ä»¶ä¹‹åï¼Œéƒ½ä¼šé€‰æ‹©å°†æ¶ˆæ¯æŒä¹…åŒ–åˆ°ä¸šåŠ¡æ•°æ®åº“ã€‚"><a href="#ä¸ç®¡æ˜¯é¢†åŸŸå†…äº‹ä»¶è¿˜æ˜¯è·¨é¢†åŸŸäº‹ä»¶ï¼Œåœ¨EventBusè§¦å‘äº‹ä»¶ä¹‹åï¼Œéƒ½ä¼šé€‰æ‹©å°†æ¶ˆæ¯æŒä¹…åŒ–åˆ°ä¸šåŠ¡æ•°æ®åº“ã€‚" class="headerlink" title="ä¸ç®¡æ˜¯é¢†åŸŸå†…äº‹ä»¶è¿˜æ˜¯è·¨é¢†åŸŸäº‹ä»¶ï¼Œåœ¨EventBusè§¦å‘äº‹ä»¶ä¹‹åï¼Œéƒ½ä¼šé€‰æ‹©å°†æ¶ˆæ¯æŒä¹…åŒ–åˆ°ä¸šåŠ¡æ•°æ®åº“ã€‚"></a>ä¸ç®¡æ˜¯é¢†åŸŸå†…äº‹ä»¶è¿˜æ˜¯è·¨é¢†åŸŸäº‹ä»¶ï¼Œåœ¨EventBusè§¦å‘äº‹ä»¶ä¹‹åï¼Œéƒ½ä¼šé€‰æ‹©å°†æ¶ˆæ¯æŒä¹…åŒ–åˆ°ä¸šåŠ¡æ•°æ®åº“ã€‚<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">def fireEvent(event: Any): Unit = &#123;</span><br><span class="line">  // æœ¬åœ°äº‹ä»¶åˆ†å‘å¤„ç†</span><br><span class="line">  dispatchEvent(event)</span><br><span class="line"> //æŒä¹…åŒ–äº‹ä»¶</span><br><span class="line">  persistenceEvent(event)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></h2><h1 id="è·¨é¢†åŸŸäº‹ä»¶æ¶ˆæ¯ä¿éšœ"><a href="#è·¨é¢†åŸŸäº‹ä»¶æ¶ˆæ¯ä¿éšœ" class="headerlink" title="è·¨é¢†åŸŸäº‹ä»¶æ¶ˆæ¯ä¿éšœ"></a>è·¨é¢†åŸŸäº‹ä»¶æ¶ˆæ¯ä¿éšœ</h1><p>è·¨é¢†åŸŸæ¶ˆæ¯éœ€è¦é€šè¿‡æ¶ˆæ¯ä¸­é—´ä»¶(MQ)æ¥è¿›è¡Œä¼ é€’ï¼Œç›®çš„å°±æ˜¯è§£é™¤ç³»ç»Ÿé—´çš„å¼ºä¾èµ–æ€§ï¼Œè§£è€¦ä¸šåŠ¡æ¨¡å—ã€‚</p>
<p>æˆ‘ä»¬çš„äº‹ä»¶æ€»çº¿å‘å¸ƒçš„è·¨é¢†åŸŸï¼ˆç³»ç»Ÿï¼‰æ¶ˆæ¯ï¼Œæ˜¯é€šè¿‡kafkaè¿™æ¬¾æ¶ˆæ¯ä¸­é—´ä»¶æ¥è¿›è¡Œå­˜å‚¨è½¬å‘çš„ã€‚å› ä¸ºæ¯ä¸€æ¡äº‹ä»¶æ¶ˆæ¯å¯¹ä¸šåŠ¡ç³»ç»Ÿéƒ½ååˆ†é‡è¦ï¼Œæˆ‘ä»¬è¦ç¡®ä¿å‘é€æ¶ˆæ¯ä¸èƒ½ä¸¢å¤±ï¼Œå¹¶æœ€ç»ˆèƒ½å¤Ÿè¢«è®¢é˜…è€…è®¢é˜…åˆ°ã€‚</p>
<h2 id="kafkaå¯¹æ¶ˆæ¯å‘é€çš„ä¿éšœ"><a href="#kafkaå¯¹æ¶ˆæ¯å‘é€çš„ä¿éšœ" class="headerlink" title="kafkaå¯¹æ¶ˆæ¯å‘é€çš„ä¿éšœ"></a>kafkaå¯¹æ¶ˆæ¯å‘é€çš„ä¿éšœ</h2><p>Kafkaçš„è¯­ä¹‰å¾ˆç›´æ¥ï¼Œå½“å‘å¸ƒä¸€æ¡æ¶ˆæ¯æ—¶ï¼Œ<code>kafka broker</code>æ”¶åˆ°åå¹¶ <code>committed</code>åˆ°äº†æ—¥å¿—ï¼Œé‚£ä¹ˆåœ¨<code>broker</code>çœ‹æ¥, è¿™ä¸ªæ¶ˆæ¯å·²ç»å‘å¸ƒæˆåŠŸäº†ï¼ŒåŒæ—¶ä¼šæœ‰ä¸€ä¸ªackæ¶ˆæ¯è¿”å›ç»™ç”Ÿäº§è€…ã€‚<br/></p>
<p>å½“ç½‘ç»œä¸å¯é æ—¶, æˆ‘ä»¬ä¼šç¢°åˆ°è¿™æ ·ä¸€ç§æƒ…å½¢ï¼šç”Ÿäº§è€…å‘é€æ¶ˆæ¯æ—¶å‘ç”Ÿç½‘ç»œé”™è¯¯ï¼Œè¿™æ—¶å°†æ— æ³•ç¡®å®šé”™è¯¯å‘ç”Ÿåœ¨brokeræ”¶åˆ°æ¶ˆæ¯å‰è¿˜æ˜¯åœ¨æ”¶åˆ°æ¶ˆæ¯å(è¿”å›ackä¸¢å¤±)ã€‚</p>
<h3 id="Kafkaçš„ä¸‰ç§è¯­ä¹‰"><a href="#Kafkaçš„ä¸‰ç§è¯­ä¹‰" class="headerlink" title="Kafkaçš„ä¸‰ç§è¯­ä¹‰"></a>Kafkaçš„ä¸‰ç§è¯­ä¹‰</h3><ul>
<li>At most once  <br/><br>æœ€å¤šä¸€æ¬¡ï¼šæ¶ˆæ¯å¯èƒ½ä¸¢å¤±ï¼Œä½†ç»ä¸ä¼šé‡å‘ã€‚</li>
<li>At least once <br/><br>è‡³å°‘ä¸€æ¬¡ï¼šæ¶ˆæ¯ç»ä¸ä¼šä¸¢å¤±ï¼Œä½†æœ‰å¯èƒ½é‡æ–°å‘é€ã€‚</li>
</ul>
<ul>
<li>Exactly once  <br/><br>æ­£å¥½ä¸€æ¬¡ï¼šè¿™æ˜¯æˆ‘ä»¬çœŸæ­£æƒ³è¦çš„ï¼Œæ¯ä¸ªæ¶ˆæ¯ä¼ é€’ä¸€æ¬¡ä¸”ä»…ä¸€æ¬¡ã€‚</li>
</ul>
<p>è¿™é‡Œæˆ‘ä»¬ç»“åˆä¸Šè¿°ä¸‰ç§è¯­ä¹‰å¹¶ä»¥å‘é€ç«¯ï¼ˆç”Ÿäº§è€…ï¼‰å’Œæ¥æ”¶ç«¯ï¼ˆæ¶ˆè´¹è€…ï¼‰å¯¹æ¶ˆæ¯æ¶ˆè´¹è¯­ä¹‰çš„ä¿éšœåˆ†åˆ«è¿›è¡Œæ¢è®¨ã€‚å¯åˆ†è§£æˆä¸¤ä¸ªé—®é¢˜ï¼šå‘é€æ¶ˆæ¯æ—¶çš„æŒä¹…æ€§ä¿éšœå’Œæ¶ˆè´¹æ¶ˆæ¯çš„ä¿éšœã€‚</p>
<h2 id="ç”Ÿäº§è€…ç«¯ï¼ˆProducerï¼‰æ¶ˆæ¯ä¿éšœ"><a href="#ç”Ÿäº§è€…ç«¯ï¼ˆProducerï¼‰æ¶ˆæ¯ä¿éšœ" class="headerlink" title="ç”Ÿäº§è€…ç«¯ï¼ˆProducerï¼‰æ¶ˆæ¯ä¿éšœ"></a>ç”Ÿäº§è€…ç«¯ï¼ˆProducerï¼‰æ¶ˆæ¯ä¿éšœ</h2><ul>
<li>æœ€å¤šä¸€æ¬¡ï¼šä¸šåŠ¡ç³»ç»Ÿåˆ›å»ºkafkaç”Ÿäº§è€…å®ä¾‹æ—¶ï¼Œé…ç½®æ¶ˆæ¯å‘é€é‡è¯•æ¬¡æ•°ä¸º0ï¼Œå¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">properties.put(retries, 0);</span><br></pre></td></tr></table></figure>
<p>å½“æ¶ˆæ¯å‘é€å¤±è´¥æ—¶ï¼Œä¸ä¼šå†å°è¯•è¿›è¡Œæ¶ˆæ¯å‘é€ï¼Œè¿™æ ·è™½ç„¶ä¿è¯äº†æ¶ˆæ¯ä¸ä¼šé‡å¤å‘é€ï¼Œä½†æ˜¯æœ‰å¯èƒ½ä¼šä¸¢å¤±æ¶ˆæ¯ï¼Œè¿™æ˜¯ç³»ç»Ÿä¸èƒ½å®¹å¿çš„ã€‚</p>
<ul>
<li>è‡³å°‘ä¸€æ¬¡ï¼šåˆ›å»ºkafkaç”Ÿäº§è€…å®ä¾‹æ—¶ï¼Œé…ç½®é‡è¯•æ¬¡æ•°å¤§äºç­‰äº1ï¼Œå¦‚ä¸‹é…ç½®å°±æ˜¯é‡è¯•2æ¬¡ï¼Œå¦‚æœç”Ÿäº§è€…è¿ç»­å‘é€æ¶ˆæ¯æˆåŠŸè€Œæ²¡æœ‰æ”¶åˆ°ackï¼Œå°±ä¼šé‡è¯•ä¸¤æ¬¡ã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">properties.put(retries, 2);</span><br></pre></td></tr></table></figure></li>
<li>æ­£å¥½ä¸€æ¬¡ï¼šåœ¨kafkaæ–°ç‰ˆä¸­ï¼Œå¢åŠ äº†äº‹åŠ¡æ¶ˆæ¯å‘é€åŠŸèƒ½å¹¶æ”¯æŒå‘é€æ¶ˆæ¯çš„å¹‚ç­‰æ€§é…ç½®ã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">properties.put(enable.idempotence, &quot;true&quot;);</span><br></pre></td></tr></table></figure>
è¿™æ ·kafkaåœ¨è‡³å°‘ä¸€æ¬¡è¯­ä¹‰çš„åŸºç¡€ä¸Šï¼ŒåŒæ—¶ä¿è¯é‡å¤å‘é€çš„æ¶ˆæ¯ä¸ä¼šå¯¼è‡´æ—¥å¿—é‡å¤ï¼Œå®Œç¾åšåˆ°äº†å‘é€ç«¯æ­£å¥½ä¸€æ¬¡ã€‚</li>
</ul>
<p>å®ƒçš„åŸç†å°±æ˜¯<code>kafka-broker</code>ä¸ºæ¯ä¸€ä¸ªç”Ÿäº§è€…åˆ†é…äº†ä¸€ä¸ª<code>PID</code>ï¼Œä»¥ä¾¿åŒºåˆ†ä¸åŒçš„ç”Ÿäº§è€…å®ä¾‹ï¼Œå½“ç„¶è¿™ä¸ª<code>PID</code>å¯¹ç”¨æˆ·ä¸é€æ˜ï¼Œç”¨æˆ·æ— éœ€è¿›è¡Œé…ç½®ã€‚å¼€å¯äº†æ¶ˆæ¯å¹‚ç­‰åï¼Œproduceråœ¨å‘é€æ¯æ¡æ¶ˆæ¯æ—¶ï¼Œéƒ½ä¼šå¸¦ä¸Šä¸€ä¸ªåºåˆ—å·(sequnceId)ï¼Œè¿™æ ·å¯ä»¥åœ¨é‡å¤å‘é€æ—¶æ ¹æ®åºåˆ—å·è¿›è¡Œå»é‡ã€‚</p>
<h2 id="æ¶ˆè´¹è€…ç«¯ï¼ˆConsumerï¼‰æ¶ˆæ¯ä¿éšœ"><a href="#æ¶ˆè´¹è€…ç«¯ï¼ˆConsumerï¼‰æ¶ˆæ¯ä¿éšœ" class="headerlink" title="æ¶ˆè´¹è€…ç«¯ï¼ˆConsumerï¼‰æ¶ˆæ¯ä¿éšœ"></a>æ¶ˆè´¹è€…ç«¯ï¼ˆConsumerï¼‰æ¶ˆæ¯ä¿éšœ</h2><ul>
<li>æ¶ˆè´¹è€…æ¥æ”¶åˆ°brokerçš„æ¶ˆæ¯åï¼Œä¼šæäº¤åç§»é‡åˆ°brokerä¸Šæ¥è¡¨ç¤ºæ¶ˆæ¯æ¶ˆè´¹æˆåŠŸã€‚</li>
<li>æˆ‘ä»¬å°†æ¶ˆè´¹è€…é…ç½®ä¸ºæ‰‹åŠ¨æäº¤åç§»é‡ï¼Œåœ¨æ•´ä¸ªæ¶ˆè´¹æ¶ˆæ¯é€»è¾‘å¤„ç†å®Œæˆï¼Œå¹¶æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸åï¼Œæ‰‹åŠ¨æäº¤åç§»é‡ã€‚</li>
<li>å¦‚æœåç§»é‡æœªæˆåŠŸæäº¤ï¼Œæ¶ˆæ¯å°†ä¼šå†æ¬¡å‘é€ç»™æ¶ˆè´¹è€…ç«¯ï¼Œè¿™æ ·å°±èƒ½å¤Ÿä¿éšœæ¶ˆæ¯ä¸ä¼šä¸¢å¤±ã€‚</li>
</ul>
<hr>
<h1 id="EventBusï¼ˆäº‹ä»¶æ€»çº¿ï¼‰æ”¶å‘æ¶ˆæ¯å…·ä½“å®ç°"><a href="#EventBusï¼ˆäº‹ä»¶æ€»çº¿ï¼‰æ”¶å‘æ¶ˆæ¯å…·ä½“å®ç°" class="headerlink" title="EventBusï¼ˆäº‹ä»¶æ€»çº¿ï¼‰æ”¶å‘æ¶ˆæ¯å…·ä½“å®ç°"></a>EventBusï¼ˆäº‹ä»¶æ€»çº¿ï¼‰æ”¶å‘æ¶ˆæ¯å…·ä½“å®ç°</h1><h2 id="EventBusç”Ÿäº§ç«¯ï¼ˆProducerï¼‰"><a href="#EventBusç”Ÿäº§ç«¯ï¼ˆProducerï¼‰" class="headerlink" title="EventBusç”Ÿäº§ç«¯ï¼ˆProducerï¼‰"></a>EventBusç”Ÿäº§ç«¯ï¼ˆProducerï¼‰</h2><h3 id="å®ç°ç”Ÿäº§è€…ç«¯è‡³å°‘ä¸€æ¬¡"><a href="#å®ç°ç”Ÿäº§è€…ç«¯è‡³å°‘ä¸€æ¬¡" class="headerlink" title="å®ç°ç”Ÿäº§è€…ç«¯è‡³å°‘ä¸€æ¬¡"></a>å®ç°ç”Ÿäº§è€…ç«¯è‡³å°‘ä¸€æ¬¡</h3><p>æˆ‘ä»¬ä¹Ÿä¼šè€ƒè™‘è¿™æ ·ä¸€ç§æƒ…å†µï¼Œå½“ä¸šåŠ¡ç³»ç»Ÿéœ€è¦è¿›è¡Œæ‰¹é‡æ¶ˆæ¯å‘é€æ—¶ï¼Œå¦‚æœä¸­é€”æŸæ¡æ¶ˆæ¯å‘é€å¤±è´¥åï¼Œéœ€è¦ä¹‹å‰å‘é€æˆåŠŸçš„æ¶ˆæ¯ä¸€èµ·å›æ»šï¼Œç±»ä¼¼äºæ•°æ®åº“ä¸Šçš„äº‹åŠ¡å›æ»šã€‚</p>
<h4 id="ç”Ÿäº§è€…é…ç½®"><a href="#ç”Ÿäº§è€…é…ç½®" class="headerlink" title="ç”Ÿäº§è€…é…ç½®"></a>ç”Ÿäº§è€…é…ç½®</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">properties.put(&quot;transactional.id&quot;,&quot;GOODS_1213&quot;);</span><br><span class="line">properties.put(&quot;enable.idempotence&quot;, &quot;true&quot;);</span><br></pre></td></tr></table></figure>
<ul>
<li>é¦–å…ˆkafkaå¯¹äº‹åŠ¡æ¶ˆæ¯çš„æ”¯æŒå‰ææ˜¯ï¼Œéœ€è¦ä¸ºæ¯ä¸ªç”Ÿäº§è€…å®ä¾‹æ˜¾å¼çš„é…ç½®å”¯ä¸€çš„äº‹åŠ¡idå·ï¼ˆå¦‚ä¸Šé…ç½®ï¼‰ï¼Œ</li>
<li>å…¶æ¬¡éœ€è¦å°†kafkaæ¶ˆæ¯å¹‚ç­‰åŠŸèƒ½è®¾ç½®ä¸ºtrueã€‚</li>
</ul>
<p>é€šè¿‡è¿™æ ·çš„é…ç½®ä¹‹åï¼Œæ¶ˆæ¯åœ¨æ‰¹é‡è¿›è¡Œå‘é€å‡ºç°å¼‚å¸¸æ—¶ï¼Œæ”¾å¼ƒå½“å‰äº‹åŠ¡å³å¯ã€‚<br>æˆ‘ä»¬å®ç°çš„<code>eventbus</code>äº‹åŠ¡å‘é€ç«¯ä»£ç å¦‚ä¸‹:</p>
<h4 id="åˆ›å»ºäº‹åŠ¡ç”Ÿäº§è€…"><a href="#åˆ›å»ºäº‹åŠ¡ç”Ÿäº§è€…" class="headerlink" title="åˆ›å»ºäº‹åŠ¡ç”Ÿäº§è€…"></a>åˆ›å»ºäº‹åŠ¡ç”Ÿäº§è€…</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">private def initTransProducer(transId: String): Unit = &#123;</span><br><span class="line">    val builder = KafkaConfigBuilder.defaultProducer</span><br><span class="line">    val properties = builder</span><br><span class="line">      .withKeySerializer(classOf[LongSerializer])</span><br><span class="line">      .withValueSerializer(classOf[ByteArraySerializer])</span><br><span class="line">      .bootstrapServers(serverHost)</span><br><span class="line">      .withTransactions(transId)</span><br><span class="line">      .withIdempotence(&quot;true&quot;) //å¹‚ç­‰æ€§ä¿è¯</span><br><span class="line">      .build</span><br><span class="line"></span><br><span class="line">    producer = new KafkaProducer[Long, Array[Byte]](properties)</span><br><span class="line">    //åˆå§‹åŒ–äº‹åŠ¡</span><br><span class="line">    producer.initTransactions()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ‰¹é‡æ¶ˆæ¯å‘é€"><a href="#æ‰¹é‡æ¶ˆæ¯å‘é€" class="headerlink" title="æ‰¹é‡æ¶ˆæ¯å‘é€"></a>æ‰¹é‡æ¶ˆæ¯å‘é€</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">def batchSend(topic: String, eventMessage: util.List[EventStore]): Unit = &#123;</span><br><span class="line">try &#123;</span><br><span class="line">      producer.beginTransaction()</span><br><span class="line">      eventMessage.forEach((eventStore: EventStore) =&gt; &#123;</span><br><span class="line">        producer.send(new ProducerRecord[Long, Array[Byte]](topic, eventStore.id, eventStore.eventBinary), (metadata: RecordMetadata, exception: Exception) =&gt; &#123;</span><br><span class="line">          logger.info(</span><br><span class="line">            s&quot;&quot;&quot;in transaction per msg ,send message to broker successful,</span><br><span class="line">        id: $&#123;eventStore.id&#125;, topic: $&#123;metadata.topic&#125;, offset: $&#123;metadata.offset&#125;, partition: $&#123;metadata.partition&#125;&quot;&quot;&quot;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">      //æ²¡æœ‰å¼‚å¸¸ï¼Œæäº¤äº‹åŠ¡</span><br><span class="line">producer.commitTransaction()</span><br><span class="line">    &#125; catch &#123;</span><br><span class="line">      case e: Exception =&gt;</span><br><span class="line">      //å›æ»šäº‹åŠ¡</span><br><span class="line">        producer.abortTransaction()</span><br><span class="line">        logger.error(e.getMessage, e)</span><br><span class="line">        logger.error(&quot;send message failed,topic: &#123;&#125;&quot;, topic)</span><br><span class="line">        throw e</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç èƒ½å¤Ÿä¿éšœåœ¨æ‰¹é‡å‘é€æ¶ˆæ¯æ—¶çš„äº‹åŠ¡ä¸€è‡´æ€§ï¼šè¦ä¹ˆæ¶ˆæ¯å…¨éƒ¨å‘é€æˆåŠŸï¼Œæäº¤äº‹åŠ¡ï¼›å¦‚æœå‡ºç°ä¸€æ¡å¤±è´¥ï¼Œåˆ™äº‹åŠ¡å›æ»šã€‚</p>
<p>å½“ç„¶ï¼Œä¸ºäº†é…åˆäº‹åŠ¡æ¶ˆæ¯ï¼Œæ¶ˆè´¹ç«¯éœ€è¦åœ¨åˆ›å»ºkafkaæ¶ˆè´¹è€…å®ä¾‹æ—¶ï¼Œé…ç½®æ¶ˆæ¯è·å–çš„éš”ç¦»çº§åˆ«ä¸º<code>read_committed</code>ï¼ˆè¯»å–å·²ç»æäº¤çš„æ¶ˆæ¯ï¼‰ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">properties.put(&quot;isolation.level&quot;, &quot;read_committed&quot;);</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·æ—¢å¯ä»¥ä¿éšœäº‹åŠ¡æ¶ˆæ¯çš„å‘é€ï¼Œåˆèƒ½ä¿éšœå¹‚ç­‰æ€§ï¼Œåœ¨æ¶ˆæ¯å‘é€ç«¯ä¸è€ƒè™‘éå¸¸æç«¯çš„æƒ…å†µä¸‹ï¼Œæ˜¯å·²ç»åšåˆ°äº†<strong>æ­£å¥½ä¸€æ¬¡</strong>çš„è¯­ä¹‰,è€ƒè™‘æç«¯æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥åšåˆ°è‡³å°‘ä¸€æ¬¡ã€‚</p>
<h3 id="æ¶ˆæ¯è½®è¯¢"><a href="#æ¶ˆæ¯è½®è¯¢" class="headerlink" title="æ¶ˆæ¯è½®è¯¢"></a>æ¶ˆæ¯è½®è¯¢</h3><blockquote>
<p>ä¸šåŠ¡ç³»ç»Ÿè§¦å‘äº‹ä»¶ä¹‹åï¼Œä¼šå°†äº‹ä»¶å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œç„¶åä¼šæœ‰ä¸€ä¸ªå®šæ—¶ä»»åŠ¡çº¿ç¨‹å®šæ—¶å»è½®è¯¢æ•°æ®åº“è·å–æ¶ˆæ¯ï¼Œå¹¶ä½¿ç”¨kafkaå°†æ¶ˆæ¯å‘é€åˆ°brokerã€‚</p>
</blockquote>
<h4 id="è®¾è®¡ç›®çš„"><a href="#è®¾è®¡ç›®çš„" class="headerlink" title="è®¾è®¡ç›®çš„"></a>è®¾è®¡ç›®çš„</h4><p>ä½¿ç”¨æ•°æ®åº“çš„äº‹åŠ¡æ¥ä¿éšœä¸šåŠ¡æœåŠ¡æ¥å£äº§ç”Ÿçš„äº‹ä»¶è·Ÿä¸šåŠ¡è¡Œä¸ºä¿æŒå¼ºä¸€è‡´æ€§ï¼Œè€Œåœ¨å®šæ—¶å‘é€æ¶ˆæ¯æ—¶ï¼Œä¹Ÿä¼šä½¿ç”¨æ•°æ®åº“äº‹åŠ¡+kafkaçš„äº‹åŠ¡ï¼Œå°†æ¶ˆæ¯å‘é€å‡ºå»ã€‚ä»¥ä¸‹ä¸ºå‘é€æ¶ˆæ¯çš„é€»è¾‘ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">def doPublishMessages(): Unit = &#123;</span><br><span class="line">    // æ¶ˆæ¯æ€»æ¡æ•°è®¡æ•°å™¨</span><br><span class="line">    val counter = new AtomicInteger(0)</span><br><span class="line">    // æ‰¹é‡å¤„ç†, æ¯æ¬¡ä»æ•°æ®åº“å–å‡ºæ¶ˆæ¯çš„æœ€å¤§æ•°é‡(window)</span><br><span class="line">    val window = 100</span><br><span class="line">    // å•è½®å¤„ç†çš„æ¶ˆæ¯è®¡æ•°å™¨, ç”¨äºæ§åˆ¶å¾ªç¯é€€å‡º.</span><br><span class="line">    val resultSetCounter = new AtomicInteger(window)</span><br><span class="line">    //å½“ä¸€æ¬¡è½®è¯¢æ‹¿åˆ°çš„æ¶ˆæ¯è¾¾åˆ°äº†æœ€å¤§æ•°æ—¶ï¼Œä¼šå†æ¬¡è½®è¯¢æ•°æ®åº“ï¼Œä»¥ç¡®ä¿è¿˜æœ‰æ¶ˆæ¯æ²¡æœ‰è¢«å‘é€</span><br><span class="line">    while (resultSetCounter.get() == window) &#123;</span><br><span class="line">      resultSetCounter.set(0)</span><br><span class="line">      //æ•°æ®åº“äº‹åŠ¡å¼€å¯</span><br><span class="line">      dataSource.withTransaction[Unit](conn =&gt; &#123;</span><br><span class="line">        //AAA</span><br><span class="line">        conn.eachRow[EventStore](sql&quot;SELECT * FROM common_event limit $&#123;window&#125; FOR UPDATE&quot;)(event =&gt; &#123;</span><br><span class="line">          conn.executeUpdate(sql&quot;DELETE FROM common_event WHERE id = $&#123;event.id&#125;&quot;)</span><br><span class="line">          //Kafkaäº‹åŠ¡ç¡®ä¿sendå¤±è´¥ä¼šå›æ»šå¹¶æŠ›å¼‚å¸¸</span><br><span class="line">          producer.send(topic, event.id, event.eventBinary)</span><br><span class="line">          resultSetCounter.incrementAndGet()</span><br><span class="line">          counter.incrementAndGet()</span><br><span class="line">        //AAA</span><br><span class="line">           </span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢AAAå—çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å°†æ¶ˆæ¯è·å–å’Œkafkaç”Ÿäº§è€…å‘é€æ¶ˆæ¯æ”¾åˆ°äº†ä¸€ä¸ªäº‹åŠ¡é‡Œï¼Œé¦–å…ˆè·å–åˆ°æ¶ˆæ¯ï¼Œç„¶ååˆ é™¤å½“å‰æ¶ˆæ¯ï¼Œå†å°†æ¶ˆæ¯å‘é€åˆ°kafkaä¸Šï¼Œä¿éšœæ¶ˆæ¯åˆšå¥½ä¸€æ¬¡çš„å‘é€ã€‚<br/></p>
<p>å¦‚æœè¿™æ—¶å€™å‡ºç°å¼‚å¸¸(kafkaå‘é€æ•°æ®å¼‚å¸¸æˆ–è€…åˆ é™¤æ•°æ®åº“è®°å½•å¼‚å¸¸)ï¼Œäº‹åŠ¡å°±ä¼šå›æ»šï¼Œæ¶ˆæ¯æ²¡æœ‰è¢«çœŸæ­£åˆ é™¤ï¼Œä¸‹ä¸€æ¬¡è½®è¯¢ä¼šå†æ¬¡æ‰§è¡Œè¿™ä¸ªè¿‡ç¨‹ã€‚ä¸è€ƒè™‘æç«¯çš„æƒ…å†µä¸‹ï¼Œè¿™æ ·çš„åšæ³•å¯ä»¥ä¿è¯æ­£å¥½ä¸€æ¬¡çš„æ¶ˆæ¯å‘é€ã€‚<br/></p>
<p>è€ƒè™‘æç«¯æƒ…å†µï¼Œå³æ¶ˆæ¯çš„åˆ é™¤å’Œkafkaå‘é€éƒ½æˆåŠŸäº†ï¼Œè€Œåœ¨äº‹åŠ¡æäº¤é‚£è¡Œä»£ç æ—¶ï¼Œå‡ºç°å¼‚å¸¸ã€‚è¿™æ—¶å€™ï¼Œæ•°æ®åº“ä¼šå›æ»šï¼Œä½†æ˜¯æ¶ˆæ¯å·²ç»è¢«å‘é€åˆ°äº†kafkaä¸Šï¼Œå› æ­¤è¿™é‡Œè¿˜æ˜¯ä¼šå‡ºç°æ¶ˆæ¯çš„é‡å¤å‘é€ï¼Œä½†æ˜¯åšåˆ°äº†è‡³å°‘ä¸€æ¬¡, è€Œä¸”è¿™ç§æƒ…å†µæ˜¯æå…¶æç«¯çš„ã€‚</p>
<h3 id="ç”Ÿäº§ç«¯æ€»ç»“"><a href="#ç”Ÿäº§ç«¯æ€»ç»“" class="headerlink" title="ç”Ÿäº§ç«¯æ€»ç»“"></a>ç”Ÿäº§ç«¯æ€»ç»“</h3><p>æˆ‘ä»¬å·²ç»åœ¨ä¸è€ƒè™‘æç«¯çš„æƒ…å†µä¸‹ï¼ˆæœåŠ¡å™¨å®•æœºï¼‰åšåˆ°äº†æ­£å¥½ä¸€æ¬¡ï¼Œè€ƒè™‘æç«¯çš„æƒ…å†µä¸‹ï¼Œåšåˆ°äº†è‡³å°‘ä¸€æ¬¡ã€‚<br/></p>
<p>ç„¶è€Œï¼Œæç«¯æƒ…å†µè¿˜æ˜¯æœ‰å¯èƒ½ä¼šå‡ºç°ï¼Œå› æ­¤æœ€å¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œæˆ‘ä»¬è¿˜ä¼šåœ¨äº‹ä»¶æ¶ˆæ¯ä¸Šé¢æ ‡è®°ä¸€ä¸ªäº‹ä»¶å”¯ä¸€IDï¼Œä»¥æ”¯æŒç”¨æˆ·åœ¨ä¸šåŠ¡ç³»ç»Ÿä¸Šæ¶ˆè´¹æ¶ˆæ¯çš„æ—¶å€™åšå¹‚ç­‰å¤„ç†ã€‚<br/></p>
<p>å¦‚ä¸‹æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ä¸šåŠ¡äº‹ä»¶çš„å®šä¹‰ã€‚ï¼ˆè¯¦æƒ…å‚è€ƒæ¨æƒæ–‡ç« ï¼‰</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">PublishedSkuEvent</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="class">   //äº‹ä»¶å”¯ä¸€id</span></span></span><br><span class="line"><span class="params"><span class="class">   id : <span class="type">Long</span>, </span></span></span><br><span class="line"><span class="params"><span class="class">   //äº‹ä»¶ä¸­æºå¸¦çš„å…·ä½“ä¸šåŠ¡</span></span></span><br><span class="line"><span class="params"><span class="class">   skuIds : <span class="type">List</span>[<span class="type">Long</span>]</span></span></span><br><span class="line"><span class="params"><span class="class"> </span>)</span></span><br></pre></td></tr></table></figure>


<p>å½“ç„¶å¹¶ä¸æ˜¯æ‰€æœ‰çš„æƒ…å†µéƒ½éœ€è¦è¿™ä¹ˆå¼ºåŠ›çš„ä¿éšœï¼Œæ¯”å¦‚å¯¹é‡å¤æ¶ˆæ¯ä¸æ˜¯å¾ˆæ•æ„Ÿçš„æƒ…å†µï¼Œæˆ‘ä»¬ä¸éœ€è¦å‘é€äº‹åŠ¡æ¶ˆæ¯æˆ–ä¿è¯æ¶ˆæ¯å¹‚ç­‰æ€§ï¼Œåªéœ€è¦åšåˆ°æ¶ˆæ¯ä¸ä¼šä¸¢å¤±å³å¯ã€‚å¯¹äºå»¶è¿Ÿæ•æ„Ÿçš„ï¼Œæˆ‘ä»¬å…è®¸ç”Ÿäº§è€…æŒ‡å®šå®ƒæƒ³è¦çš„è€ç”¨æ€§æ°´å¹³ã€‚å¦‚ç”Ÿäº§è€…å¯ä»¥æŒ‡å®šå®ƒè·å–éœ€ç­‰å¾…10æ¯«ç§’é‡çº§ä¸Šçš„å“åº”ã€‚ç”Ÿäº§è€…ä¹Ÿå¯ä»¥æŒ‡å®šå¼‚æ­¥å‘é€ï¼Œæˆ–åªç­‰å¾…leaderï¼ˆä¸éœ€è¦å‰¯æœ¬çš„å“åº”ï¼‰æœ‰å“åº”ã€‚</p>
<h2 id="Eventbusæ¶ˆæ¯ç«¯ï¼ˆConsumerï¼‰"><a href="#Eventbusæ¶ˆæ¯ç«¯ï¼ˆConsumerï¼‰" class="headerlink" title="Eventbusæ¶ˆæ¯ç«¯ï¼ˆConsumerï¼‰"></a>Eventbusæ¶ˆæ¯ç«¯ï¼ˆConsumerï¼‰</h2><blockquote>
<p>æ¶ˆè´¹ç«¯åˆ†ä¸ºé¢†åŸŸå†…äº‹ä»¶æ¶ˆè´¹å’Œè·¨é¢†åŸŸäº‹ä»¶æ¶ˆè´¹ï¼Œé¢†åŸŸå†…ç”±äºåœ¨åŒä¸€ä¸ªäº‹åŠ¡å†…ï¼Œå¼ºä¸€è‡´æ€§ï¼Œå®ç°ç®€å•ï¼Œæˆ‘ä»¬è¿™é‡Œä¸å†èµ˜è¿°ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸‹å¦‚ä½•åšåˆ°è·¨é¢†åŸŸæ¶ˆæ¯è®¢é˜…å’Œæ¥æ”¶ã€‚</p>
</blockquote>
<h3 id="æ¶ˆæ¯çš„ç¼–è§£ç "><a href="#æ¶ˆæ¯çš„ç¼–è§£ç " class="headerlink" title="æ¶ˆæ¯çš„ç¼–è§£ç "></a>æ¶ˆæ¯çš„ç¼–è§£ç </h3><p>å‰æ–‡æ²¡æœ‰æåˆ°çš„ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†äº‹ä»¶å®šä¹‰ä¸ºthriftç»“æ„ä½“ï¼Œå¹¶å°†å…¶åºåˆ—åŒ–ä¸ºå­—èŠ‚æµä¹‹åæŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­ï¼Œkafkaå‘é€çš„æ—¶å€™, æ¶ˆæ¯å†…å®¹æ˜¯åºåˆ—åŒ–ä¹‹åçš„äºŒè¿›åˆ¶byteæ•°ç»„ï¼Œæ¶ˆè´¹ç«¯åœ¨æ¥æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œéœ€è¦è¿›è¡Œååºåˆ—åŒ–å’Œè§£ç åï¼Œæ‰èƒ½å¾—åˆ°æ¶ˆæ¯å¯¹è±¡ã€‚å› æ­¤æˆ‘ä»¬è®¾è®¡çš„apiå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@KafkaConsumer(groupId = &quot;TEST01&quot;, topic =&quot;GOODS&quot;)</span><br><span class="line">public class EventConsumer &#123;</span><br><span class="line">   //å®šä¹‰æ¶ˆæ¯çš„è§£ç å™¨</span><br><span class="line">    @KafkaListener(serializer = GoodsCreatedEventSerializer.class)</span><br><span class="line">    public void onGoodsCreatedEvent(GoodsCreatedEvent event) &#123;</span><br><span class="line">        // dosomething</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @KafkaListener(serializer = GoodsRegisteredEventSerializer.class)</span><br><span class="line">    public void onGoodsRegisteredEvent(GoodsRegisteredEvent event) &#123;</span><br><span class="line">        // dosomething</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@KafkaConsumer(groupId = &quot;TEST01&quot;, topic =&quot;SUPPLIER&quot;)</span><br><span class="line">public class EventConsumer &#123;</span><br><span class="line">   </span><br><span class="line">    @KafkaListener(serializer = SupplierCreatedEventSerializer.class)</span><br><span class="line">    public void onSupplierCreatedEvent(SupplierCreatedEvent event) &#123;</span><br><span class="line">        // dosomething</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p><code>@KafkaConsumer</code>æ ‡äºç›‘å¬ç±»ä¸Šï¼Œå®šä¹‰æ¶ˆè´¹è€…ç»„å’Œå…³å¿ƒçš„topicã€‚<br/><br><code>@KafkaListener</code>æ ‡äºç›‘å¬æ–¹æ³•ä¸Š,å®šä¹‰è¯¥æ–¹æ³•ç›‘å¬çš„æ¶ˆæ¯ç±»å‹æ‰€éœ€è¦çš„<strong>åºåˆ—åŒ–å™¨çš„class</strong>ã€‚</p>
<h3 id="å®ç°åŸç†"><a href="#å®ç°åŸç†" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h3><ul>
<li>ä¸šåŠ¡ç³»ç»Ÿéœ€è¦æŠŠå¦‚ä¸Šä¸¤ä¸ªæ¶ˆæ¯ç›‘å¬ç±»äº¤ç»™Springè¿›è¡Œç®¡ç†ã€‚</li>
<li>åœ¨å¯åŠ¨å®¹å™¨æ—¶ï¼Œeventbusç±»åº“é‡Œçš„<code>MsgAnnotationBeanPostProcessor</code>ä¼šå¯¹springç®¡ç†çš„beanè¿›è¡Œæ‰«æï¼Œå¦‚æœå‘ç°æœ‰beanç±»ä¸Šé¢æœ‰<code>@KafkaConsumer</code>æ³¨è§£æ—¶ï¼Œå°±ä¼šå°†è¿›ä¸€æ­¥åˆ¤æ–­è¯¥ç±»ä¸‹é¢æ˜¯å¦æœ‰æ ‡æœ‰<code>@KafkaListener</code>çš„æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼ˆåªæ˜¾ç¤ºä¸»è¦é€»è¾‘ï¼‰</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®ä¾‹åŒ–åŠä¾èµ–æ³¨å…¥å®Œæˆåã€åœ¨ä»»ä½•åˆå§‹åŒ–ä»£ç ï¼ˆæ¯”å¦‚é…ç½®æ–‡ä»¶ä¸­çš„init-methodï¼‰è°ƒç”¨ä¹‹åè°ƒç”¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">    Class&lt;?&gt; targetClass = AopUtils.getTargetClass(bean);</span><br><span class="line">    <span class="comment">//è·å–ç±»ä¸Šæ˜¯å¦æœ‰æ³¨è§£ @KafkaConsumer</span></span><br><span class="line">    Optional&lt;KafkaConsumer&gt; kafkaConsumer = findListenerAnnotations(targetClass);</span><br><span class="line">    <span class="comment">//ç±»ä¸Šæ˜¯å¦æœ‰æ³¨è§£</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">hasKafkaConsumer</span> <span class="operator">=</span> kafkaConsumer.isPresent();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (hasKafkaConsumer) &#123;</span><br><span class="line">        <span class="comment">//æ–¹æ³•åˆ—è¡¨ ï¼ŒæŸ¥æ‰¾æ–¹æ³•ä¸Šæ ‡æœ‰ @KafkaListener çš„æ³¨è§£</span></span><br><span class="line">        Map&lt;Method, Set&lt;KafkaListener&gt;&gt; annotatedMethods = MethodIntrospector.selectMethods(targetClass,</span><br><span class="line">            (MethodIntrospector.MetadataLookup&lt;Set&lt;KafkaListener&gt;&gt;) method -&gt; &#123;</span><br><span class="line">                Set&lt;KafkaListener&gt; listenerMethods = findListenerAnnotations(method);</span><br><span class="line">                <span class="keyword">return</span> (!listenerMethods.isEmpty() ? listenerMethods : <span class="literal">null</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        <span class="keyword">if</span> (annotatedMethods.isEmpty()) &#123;</span><br><span class="line">            <span class="comment">// throw Exception</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!annotatedMethods.isEmpty()) &#123;</span><br><span class="line">            <span class="comment">// Non-empty set of methods</span></span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;Method, Set&lt;KafkaListener&gt;&gt; entry : annotatedMethods.entrySet()) &#123;</span><br><span class="line">                <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> entry.getKey();</span><br><span class="line">                <span class="keyword">for</span> (KafkaListener listener : entry.getValue()) &#123;</span><br><span class="line">                    <span class="comment">// process annotation information</span></span><br><span class="line">                    processKafkaListener(kafkaConsumer.get(), listener, method, bean, beanName);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            logger.info(<span class="string">&quot;there are &#123;&#125; methods have @KafkaListener on This bean &quot;</span>, binlogMethods.size());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.logger.info(<span class="string">&quot;No @KafkaConsumer annotations found on bean type: &quot;</span> + bean.getClass());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>å¦‚æœå½“å‰beanæœ‰<code>@KafkaConsumer</code>æ³¨è§£å’Œ<code>@KafkaListener</code>æ³¨è§£ï¼Œå°±ä¼šåˆ›å»ºå½“å‰<code>consumer</code>ä¸Šä¸‹æ–‡ï¼Œä¿å­˜è¯¥ç±»çš„<code>groupId,topic,serializer</code>ç­‰ä¿¡æ¯ï¼Œå¹¶å°†è¿™äº›ä¿¡æ¯æ³¨å†Œåˆ°<code>KafkaListenerRegistrar</code>ä¸Šé¢ï¼ŒKafkaListenerRegistrarä¼šä»¥groupIdå’Œtopicè”åˆä½œä¸ºkeyï¼Œå¹¶åˆ›å»ºä¸€ä¸ª<code>kafkaConsumer</code>å®ä¾‹ï¼Œæ”¾å…¥ä¸€ä¸ªå®ä¾‹åˆ—è¡¨ä¸­ï¼Œç›¸åŒçš„groupIdå’Œtopicä¼šä½¿ç”¨åŒä¸€ä¸ªkafkaConsumerå®ä¾‹ã€‚ä»£ç å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KafkaListenerRegistrar</span> <span class="keyword">implements</span> <span class="title class_">InitializingBean</span> &#123;</span><br><span class="line">    <span class="comment">//kafkaConsumerå®ä¾‹åˆ—è¡¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, MsgKafkaConsumer&gt; EVENT_CONSUMERS = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ³¨å†Œä¸šåŠ¡consumer</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerEndpoint</span><span class="params">(ConsumerEndpoint endpoint)</span> &#123;</span><br><span class="line">        Assert.notNull(endpoint, <span class="string">&quot;Endpoint must be set&quot;</span>);</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">            addConsumer(endpoint);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ·»åŠ consumeråˆ°åˆ—è¡¨ï¼Œæ ¹æ®keyåˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addConsumer</span><span class="params">(ConsumerEndpoint endpoint)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">groupId</span> <span class="operator">=</span> endpoint.getGroupId();</span><br><span class="line">        <span class="type">String</span> <span class="variable">topic</span> <span class="operator">=</span> endpoint.getTopic();</span><br><span class="line">        <span class="type">String</span> <span class="variable">kafkaHost</span> <span class="operator">=</span> endpoint.getKafkaHost();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// é»˜è®¤ group id</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> endpoint.getBean().getClass().getName();</span><br><span class="line">            groupId = <span class="string">&quot;&quot;</span>.equals(groupId) ? className : groupId;</span><br><span class="line">            <span class="type">String</span> <span class="variable">consumerKey</span> <span class="operator">=</span> groupId + <span class="string">&quot;:&quot;</span> +   topic;</span><br><span class="line">            <span class="comment">//åˆ¤æ–­key</span></span><br><span class="line">            <span class="keyword">if</span> (EVENT_CONSUMERS.containsKey(consumerKey)) &#123;</span><br><span class="line">                EVENT_CONSUMERS.get(consumerKey).addConsumer(endpoint);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">MsgKafkaConsumer</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MsgKafkaConsumer</span>(kafkaHost, groupId, topic);</span><br><span class="line">                consumer.addConsumer(endpoint);</span><br><span class="line">                EVENT_CONSUMERS.put(consumerKey, consumer);</span><br><span class="line">            &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(e.getMessage(), e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å½“æ‰€æœ‰beanè¢«æ‰«æå®Œåï¼Œä¼šè°ƒç”¨æ­¤æ–¹æ³•ï¼Œå¯åŠ¨kafkaConsumerå®ä¾‹</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;ready to start consumer ,event consumer size &#123;&#125;, binlog consumer size &#123;&#125;&quot;</span>, EVENT_CONSUMERS.size(), BINLOG_CONSUMERS.size());</span><br><span class="line"></span><br><span class="line">        EVENT_CONSUMERS.values().forEach(Thread::start);</span><br><span class="line"></span><br><span class="line">        BINLOG_CONSUMERS.values().forEach(Thread::start);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>åœ¨ä¸Šé¢ä»£ç ä¸­ï¼ŒMsgKafkaConsumerå¤„ç†æ¶ˆæ¯æ¥æ”¶å’Œè§£ç ï¼Œå¹¶å°†è§£ç åç”Ÿäº§çš„å…·ä½“äº‹ä»¶å†…å®¹ä½œä¸ºå‚æ•°ï¼Œé€šè¿‡åå°„è°ƒç”¨å…³æ³¨äº†è¯¥topicçš„æ–¹æ³•ï¼Œä¸»è¦é€»è¾‘å¦‚ä¸‹ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"> public void run() &#123;</span><br><span class="line">        logger.info(&quot;[KafkaConsumer][&#123;&#125;][run] &quot;, this.groupId + &quot;:&quot; + this.topic);</span><br><span class="line">        this.consumer.subscribe(Arrays.asList(this.topic));</span><br><span class="line">        while (true) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                ConsumerRecords&lt;Long, byte[]&gt; records = consumer.poll(100);</span><br><span class="line">                for (ConsumerRecord&lt;Long, byte[]&gt; record : records) &#123;</span><br><span class="line">                    logger.info(&quot;receive message,ready to process, topic: &#123;&#125; ,partition: &#123;&#125; ,offset: &#123;&#125;&quot;,</span><br><span class="line">                            record.topic(), record.partition(), record.offset());</span><br><span class="line"></span><br><span class="line">                    for (ConsumerEndpoint consumer : bizConsumers) &#123;</span><br><span class="line">                        dealMessage(consumer, record.value());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                try &#123;</span><br><span class="line">consumer.commitSync();</span><br><span class="line">                &#125; catch (CommitFailedException e) &#123;</span><br><span class="line">                    logger.error(&quot;commit failed&quot;, e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">                logger.error(&quot;[KafkaConsumer][&#123;&#125;][run] &quot; + e.getMessage(), groupId + &quot;:&quot; + topic, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // æ”¶åˆ°æ¶ˆæ¯åå…·ä½“å¤„ç†</span><br><span class="line">    protected void dealMessage(ConsumerEndpoint consumer, byte[] message) &#123;</span><br><span class="line">        logger.info(&quot;Iterator and process biz message groupId: &#123;&#125;, topic: &#123;&#125;&quot;, groupId, topic);</span><br><span class="line"></span><br><span class="line">        KafkaMessageProcessor processor = new KafkaMessageProcessor();</span><br><span class="line">        String eventType = processor.getEventType(message);</span><br><span class="line"></span><br><span class="line">        List&lt;Class&lt;?&gt;&gt; parameterTypes = consumer.getParameterTypes();</span><br><span class="line"></span><br><span class="line">        long count = parameterTypes.stream()</span><br><span class="line">                .filter(param -&gt; param.getName().equals(eventType))</span><br><span class="line">                .count();</span><br><span class="line"></span><br><span class="line">        if (count &gt; 0) &#123;</span><br><span class="line">            byte[] eventBinary = processor.getEventBinary();</span><br><span class="line"></span><br><span class="line">            try &#123;</span><br><span class="line">                Object event = processor.decodeMessage(eventBinary, consumer.getEventSerializer());</span><br><span class="line">                consumer.getMethod().invoke(consumer.getBean(), event);</span><br><span class="line">                logger.info(&quot;invoke message end ,bean: &#123;&#125;, method: &#123;&#125;&quot;, consumer.getBean(), consumer.getMethod());</span><br><span class="line">            &#125; catch (IllegalAccessException | InvocationTargetException | IllegalArgumentException e) &#123;</span><br><span class="line">                logger.error(&quot;å‚æ•°ä¸åˆæ³•ï¼Œå½“å‰æ–¹æ³•è™½ç„¶è®¢é˜…æ­¤topicï¼Œä½†æ˜¯ä¸æ¥æ”¶å½“å‰äº‹ä»¶:&quot; + eventType, e);</span><br><span class="line">            &#125; catch (TException e) &#123;</span><br><span class="line">                logger.error(e.getMessage(), e);</span><br><span class="line">                logger.error(&quot;ååºåˆ—åŒ–äº‹ä»¶&quot; + eventType + &quot;å‡ºé”™&quot;);</span><br><span class="line">            &#125; catch (InstantiationException e) &#123;</span><br><span class="line">                logger.error(e.getMessage(), e);</span><br><span class="line">                logger.error(&quot;å®ä¾‹åŒ–äº‹ä»¶&quot; + eventType + &quot;å¯¹åº”çš„ç¼–è§£ç å™¨å¤±è´¥&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            logger.debug(&quot;æ–¹æ³• [ &#123;&#125; ] ä¸æ¥æ”¶å½“å‰æ”¶åˆ°çš„æ¶ˆæ¯ç±»å‹ &#123;&#125; &quot;, consumer.getMethod(), eventType);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
æ¶ˆè´¹è€…è®¾ç½®ä¸ºæ‰‹åŠ¨æäº¤åç§»é‡ï¼Œåœ¨ä¸€æ¬¡pollè¯·æ±‚ä¸­ï¼Œå½“æ¶ˆæ¯æˆåŠŸæ¶ˆè´¹åï¼Œä¼šåŒæ­¥æäº¤æœ¬æ¬¡pollçš„æ¶ˆæ¯åç§»é‡ã€‚</li>
</ul>
<p>å¦‚æœæ¶ˆæ¯æ¶ˆè´¹äº†ï¼Œä½†æ˜¯åœ¨æœªæäº¤åç§»é‡ä¹‹å‰ï¼Œæ¶ˆæ¯æ˜¯ä¸ä¼šä¸¢å¤±çš„ï¼ˆæœªå¤„ç†ï¼‰ã€‚å½“æ¶ˆæ¯æ¶ˆè´¹åï¼Œå‡†å¤‡æäº¤åç§»é‡æ˜¯ç³»ç»Ÿå‡ºé”™äº†ï¼Œè¿™æ—¶å€™ä¼šå¯¼è‡´é‡å¤æ¶ˆè´¹ï¼Œå› æ­¤ä¹Ÿæ˜¯è‡³å°‘ä¸€æ¬¡çš„è¯­ä¹‰ã€‚æ‰€ä»¥è¿™é‡Œäº¤ç»™ä¸šåŠ¡ç³»ç»Ÿæ—¶ï¼Œè¿˜æ˜¯éœ€è¦ä¸šåŠ¡å»å®ç°ä¸šåŠ¡å»é‡ã€‚</p>
<h3 id="æ¶ˆè´¹ç«¯æ³¨æ„äº‹é¡¹"><a href="#æ¶ˆè´¹ç«¯æ³¨æ„äº‹é¡¹" class="headerlink" title="æ¶ˆè´¹ç«¯æ³¨æ„äº‹é¡¹"></a>æ¶ˆè´¹ç«¯æ³¨æ„äº‹é¡¹</h3><p>æˆ‘ä»¬åœ¨topicçš„åŸºç¡€ä¸Šè¿›è¡Œäº†æ›´ç»†ç²’åŒ–çš„åŒºåˆ†ï¼Œæ¶ˆæ¯èƒ½å¤Ÿæ ¹æ®è®¢é˜…è€…æ‰€æ„Ÿå…´è¶£çš„äº‹ä»¶ç±»å‹è¿›è¡Œé€‰æ‹©æ€§å‘é€ã€‚<br/></p>
<p>å³ä½¿ä¸¤ä¸ªè®¢é˜…è€…æ–¹æ³•éƒ½è®¢é˜…äº†åŒä¸€ä¸ªtopicï¼Œkafkaæ¶ˆè´¹è€…ä»ç„¶ä¼šæ ¹æ®æ¥æ”¶åˆ°çš„æ¶ˆæ¯çš„ç±»å‹å’Œè®¢é˜…è€…æ–¹æ³•çš„æ‰€æ„Ÿå…´è¶£çš„äº‹ä»¶ç±»å‹è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœå½“å‰æ¥æ”¶åˆ°çš„äº‹ä»¶ä¸è®¢é˜…äº‹ä»¶ä¸€è‡´ï¼Œä¾¿ä¼šé€šè¿‡åå°„<strong>è°ƒç”¨è®¢é˜…è€…æ–¹æ³•</strong>ï¼Œå¹¶å°†æ”¶åˆ°çš„å…·ä½“äº‹ä»¶ä¹Ÿä¼ é€’è¿‡å»ï¼Œäº‹ä»¶æ¥æ”¶æˆåŠŸã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<p>å¦‚æœ<code>kafkaConsumer</code>ä»brokeræ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œè§£ç ä¹‹åå‘ç°äº‹ä»¶ç±»å‹ä¸º<code>UserCreated</code>,é‚£ä»–åªä¼šnotifyæ¥æ”¶å‚æ•°ä¸º<code>UserCreated</code>äº‹ä»¶çš„æ–¹æ³•ï¼Œè€Œä¸ä¼šå»è°ƒç”¨æ¥æ”¶<code>UserRegisted</code>çš„è®¢é˜…è€…æ–¹æ³•ã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>DDDé¢†åŸŸäº‹ä»¶çš„æ¶ˆæ¯æ€»çº¿åˆ†æå°±åˆ°è¿™é‡Œï¼Œæœ¬æ–‡é‡ç‚¹è®²äº†è·¨é¢†åŸŸæ—¶ï¼Œé€šè¿‡kafkaæ¶ˆæ¯ä¸­é—´ä»¶å¦‚ä½•åšåˆ°æ¶ˆæ¯çš„ç¨³å®šå‘é€å’Œæ¥æ”¶ï¼Œä¸å‡ºç°æ¶ˆæ¯ä¸¢å¤±ï¼Œè§¦å‘äº‹ä»¶è€Œæœªå‘é€ç­‰æƒ…å†µã€‚</p>
</div><div class="post-copyright"><script type="text/javascript" src="/js/copyright.js?v=1.0.0" successtext="å¤åˆ¶æˆåŠŸï¼"></script><link rel="stylesheet" type="text/css" href="/css/copyright.css?v=1.0.0"><p><span>æœ¬æ–‡æ ‡é¢˜ï¼š</span>äº‹ä»¶æ€»çº¿EventBuså®ç°æ¶æ„åŸç†åˆ†æ</p><p><span>æ–‡ç« ä½œè€…ï¼š</span>StruggleYang</p><p><span>å‘å¸ƒæ—¶é—´ï¼š</span>2018-03-16</p><p><span>æœ€åæ›´æ–°ï¼š</span>2023-04-27</p><p><span>åŸå§‹é“¾æ¥ï¼š</span><a href="/2018/03/16/eventbus-archtech-0316/">https://struy.cn/2018/03/16/eventbus-archtech-0316/</a><span class="copy-path"><i class="fa fa-clipboard" data-clipboard-text="https://struy.cn/2018/03/16/eventbus-archtech-0316/"></i></span></p><p><span>ç‰ˆæƒå£°æ˜ï¼š</span>æœªç»å…è®¸ç¦æ­¢è½¬è½½ï¼Œè¯·å…³æ³¨å…¬ä¼—å·è”ç³»ä½œè€…</p></div><br><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DDD/" rel="tag">DDD</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Dapeng%E5%BE%AE%E6%9C%8D%E5%8A%A1/" rel="tag">Dapengå¾®æœåŠ¡</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1/" rel="tag">é¢†åŸŸé©±åŠ¨è®¾è®¡</a></li></ul></div><div class="post-nav"><a class="pre" href="/2018/04/30/influxdb-commons-action/">influxdbå¸¸ç”¨æ“ä½œ</a><a class="next" href="/2018/03/10/DDD-event-bus/">é¢†åŸŸäº‹ä»¶åŠäº‹ä»¶æ€»çº¿EventBusä½¿ç”¨å®è·µ</a></div><div id="container"></div><link rel="stylesheet" type="text/css" href="//unpkg.com/gitalk/dist/gitalk.css"><script type="text/javascript" src="//cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js"></script><script type="text/javascript" src="//unpkg.com/gitalk/dist/gitalk.min.js"></script><script>var gitalk = new Gitalk({
  clientID: 'f9f8d6e8db578e1d4cec',
  clientSecret: 'a26c8b120d01d4d92eb4b69f5b4e9683b1ef9c3d',
  repo: 'struy-cn.github.io',
  owner: 'struy-cn',
  admin: ['StruggleYang'],
  id: md5(location.pathname),
  distractionFreeMode: false
})
gitalk.render('container')
</script></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://struy.cn"/></form></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="å…³äº"><img class="nofancybox" src="http://img.struy.cn/img/202209061104733.png"/></a><p>èŠ±æœ‰é‡å¼€æ—¥ï¼Œäººæ— å†å°‘å¹´</p><a class="info-icon" href="https://space.bilibili.com/243215490" title="bilibili" target="_blank" style="margin-inline:5px"> <i class="fa fa-twitter-square" style="margin-inline:5px"></i></a><a class="info-icon" href="mailto:yq1724555319@gmail.com" title="Email" target="_blank" style="margin-inline:5px"> <i class="fa fa-envelope-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/StruggleYang" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a><a class="info-icon" href="/atom.xml" title="RSS" target="_blank" style="margin-inline:5px"> <i class="fa fa-rss-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> åˆ†ç±»</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/AIGC/">AIGC</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/">æ€§èƒ½ä¼˜åŒ–</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%94%9F%E4%BA%A7%E5%8A%9B%E5%B7%A5%E5%85%B7/">ç”Ÿäº§åŠ›å·¥å…·</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%A4%E7%9F%A5%E6%8F%90%E5%8D%87/">è®¤çŸ¥æå‡</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> æ ‡ç­¾</i></div><div class="tagcloud"><a href="/tags/Angular/" style="font-size: 15px;">Angular</a> <a href="/tags/WebGis/" style="font-size: 15px;">WebGis</a> <a href="/tags/DDD/" style="font-size: 15px;">DDD</a> <a href="/tags/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1/" style="font-size: 15px;">é¢†åŸŸé©±åŠ¨è®¾è®¡</a> <a href="/tags/EventBus/" style="font-size: 15px;">EventBus</a> <a href="/tags/Dapeng%E5%BE%AE%E6%9C%8D%E5%8A%A1/" style="font-size: 15px;">Dapengå¾®æœåŠ¡</a> <a href="/tags/AIGC/" style="font-size: 15px;">AIGC</a> <a href="/tags/Stable-Diffusion/" style="font-size: 15px;">Stable Diffusion</a> <a href="/tags/AI%E7%BB%98%E5%9B%BE/" style="font-size: 15px;">AIç»˜å›¾</a> <a href="/tags/CICD/" style="font-size: 15px;">CICD</a> <a href="/tags/DevOps/" style="font-size: 15px;">DevOps</a> <a href="/tags/%E6%91%98%E5%BD%95/" style="font-size: 15px;">æ‘˜å½•</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/Filebeat/" style="font-size: 15px;">Filebeat</a> <a href="/tags/ELK/" style="font-size: 15px;">ELK</a> <a href="/tags/cgroup/" style="font-size: 15px;">cgroup</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/%E5%8F%AF%E8%A7%82%E6%B5%8B%E6%80%A7/" style="font-size: 15px;">å¯è§‚æµ‹æ€§</a> <a href="/tags/Github-Copilot/" style="font-size: 15px;">Github Copilot</a> <a href="/tags/AI%E7%BC%96%E7%A0%81/" style="font-size: 15px;">AIç¼–ç </a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/GithubPages/" style="font-size: 15px;">GithubPages</a> <a href="/tags/Shell/" style="font-size: 15px;">Shell</a> <a href="/tags/Influxdb/" style="font-size: 15px;">Influxdb</a> <a href="/tags/%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 15px;">æ—¶åºæ•°æ®åº“</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 15px;">å·¥å…·</a> <a href="/tags/%E8%AF%BB%E4%B9%A6/" style="font-size: 15px;">è¯»ä¹¦</a> <a href="/tags/Maven/" style="font-size: 15px;">Maven</a> <a href="/tags/Scala/" style="font-size: 15px;">Scala</a> <a href="/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" style="font-size: 15px;">å‡½æ•°å¼ç¼–ç¨‹</a> <a href="/tags/%E8%A7%82%E7%82%B9/" style="font-size: 15px;">è§‚ç‚¹</a> <a href="/tags/Docker/" style="font-size: 15px;">Docker</a> <a href="/tags/Vue/" style="font-size: 15px;">Vue</a> <a href="/tags/%E7%94%B5%E5%BD%B1/" style="font-size: 15px;">ç”µå½±</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> å‹æƒ…é“¾æ¥</i></div><ul></ul><a href="https://githubedu.struy.cn/" title="GitHub å­¦ç”ŸåŒ…è®¤è¯" target="_blank">GitHub å­¦ç”ŸåŒ…è®¤è¯</a><ul></ul><a href="https://hzways.gitee.io/" title="éæ™®é€šç¨‹åºå‘˜" target="_blank">éæ™®é€šç¨‹åºå‘˜</a><ul></ul><a href="https://github.red/" title="E99p1ant" target="_blank">E99p1ant</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright Â© 2023 <a href="/." rel="nofollow">è€æ¨çš„çŸ¥è¯†è’åŸ.</a><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async="async"></script><div><span id="busuanzi_container_site_pv">æœ¬ç«™ <span id="busuanzi_value_site_pv"></span><span> æ¬¡è®¿é—®</span></span><span id="busuanzi_container_site_uv">. <span id="busuanzi_value_site_uv"></span><span> ä¸ªè®¿å®¢</span></span></div>Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><script type="text/javascript" src="/js/love.js?v=1.0.0"></script><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="å¤åˆ¶æˆåŠŸï¼"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>